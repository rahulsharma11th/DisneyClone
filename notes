import React, { useState, useEffect } from 'react';
import { MSGraphClient } from '@microsoft/sp-http';

const OrgChartComponent = ({ graphClient }) => {
  const [hierarchy, setHierarchy] = useState(null);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchOrgHierarchy = async (userId, client) => {
      try {
        const user = await client.api(`/users/${userId}`).select('displayName').get();
        const userReportsResponse = await client.api(`/users/${userId}/directReports`).get();
        const userReports = userReportsResponse.value;

        let hierarchyNode = {
          user: user.displayName,
          reports: []
        };

        for (let report of userReports) {
          if (report['@odata.type'] === '#microsoft.graph.user') {
            const reportHierarchy = await fetchOrgHierarchy(report.id, client);
            hierarchyNode.reports.push(reportHierarchy);
          }
        }

        return hierarchyNode;
      } catch (error) {
        console.error('Error fetching organization hierarchy', error);
        throw error;
      }
    };

    graphClient.then(client => {
      fetchOrgHierarchy('me', client)
        .then(fetchedHierarchy => {
          setHierarchy(fetchedHierarchy);
        })
        .catch(error => {
          setError(error.message || 'Error fetching data');
        });
    });
  }, [graphClient]);

  const renderOrgChart = () => {
    // Implement the visualization logic for the organization chart
  };

  return (
    <div>
      {error && <div>Error: {error}</div>}
      {hierarchy ? renderOrgChart() : <div>Loading...</div>}
    </div>
  );
};

export default OrgChartComponent;
